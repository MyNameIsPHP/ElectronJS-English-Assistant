(self.webpackChunk=self.webpackChunk||[]).push([[100],{75003:(e,t,i)=>{i.d(t,{aH:()=>o,D$:()=>p,_z:()=>d});var o,s=i(90361),n=i(14601),r=i(78674),a=i(85985),l=i(38983),u=i(7309);!function(e){let t,i,o,s;!function(e){e.default="default",e.emogenie="emogenie",e.readersAttention="readersAttention",e.readersAttentionHelp="readersAttentionHelp",e.feedback="feedback",e.settings="settings",e.proofitRequest="proofitRequest",e.proofitReview="proofitReview",e.popup="popup",e.startupPlaceholder="startupPlaceholder"}(t=e.Type||(e.Type={})),function(e){let t;!function(e){let t;!function(e){e.predictionWidget="predictionWidget",e.navigation="navigation",e.readersAttentionItem="readersAttentionItem"}(t=e.Type||(e.Type={}))}(t=e.Caller||(e.Caller={}))}(i=e.ReadersAttention||(e.ReadersAttention={})),function(e){let t;!function(e){e.headerButton="headerButton",e.descriptionLink="descriptionLink"}(t=e.Caller||(e.Caller={}))}(o=e.ReadersAttentionHelp||(e.ReadersAttentionHelp={})),function(e){let t;!function(e){e.none="none"}(t=e.Type||(e.Type={}))}(s=e.Popup||(e.Popup={})),e.isDefault=function(t){return t.type===e.Type.default},e.isEmogenie=function(t){return t.type===e.Type.emogenie},e.isReadersAttention=function(t){return t.type===e.Type.readersAttention},e.isReadersAttentionHelp=function(t){return t.type===e.Type.readersAttentionHelp},e.isFeedback=function(t){return t.type===e.Type.feedback},e.isSettings=function(t){return t.type===e.Type.settings},e.isProofitRequest=function(t){return t.type===e.Type.proofitRequest},e.isProofitReview=function(t){return t.type===e.Type.proofitReview},e.isPopup=function(t){return t.type===e.Type.popup},e.hasAlerts=function(e){switch(e.type){case t.default:case t.emogenie:case t.readersAttention:return!0;default:return!1}}}(o||(o={}));class p{constructor(e,t,i,u,p,d){this._defaultView=i,this.browser=p,this.layout=d,this._sub=new n.w,this.viewHistory=[],this.isHeaderNavigationEnabled=l.h.create(!0).view(),this._activeView=l.h.create({type:o.Type.startupPlaceholder}),this._sub.add(e.subscribe((e=>{if(e.length>0)for(;!o.hasAlerts(this._activeView.get());)this.popActiveView()}))),u&&this._sub.add(t.pipe(r.b(100),a.h(s.fQ)).subscribe((()=>{if(u.has(this._activeView.get().type))for(;this._activeView.get().type!==this._defaultView.type;)this.popActiveView()})))}get activeView(){return this._activeView.view()}get lastView(){return this.viewHistory[this.viewHistory.length-1]||this._defaultView}pushActiveView(e){const t=this._activeView.get();e.type!==t.type&&(t.type!==o.Type.startupPlaceholder&&this.viewHistory.push(t),this._activeView.set(e))}popActiveView(){const e=this.viewHistory.pop()||this._defaultView;this._activeView.set(e)}replaceActiveView(e){e.type!==this._activeView.get().type&&this._activeView.set(e)}dispose(){this._sub.unsubscribe()}}class d extends p{constructor(e,t,i,s,n=u.V.classicAssistantLayout){super(t,i,{type:o.Type.default},new Set([o.Type.readersAttention,o.Type.emogenie]),s,n),this.isHeaderNavigationEnabled=this._activeView.view((e=>e.type!==o.Type.feedback)),this._sub.add(this._activeView.subscribe((t=>{switch(t.type){case o.Type.settings:return void e.assistantSettingsShow();case o.Type.proofitRequest:return void e.proofitRequestFormShow();default:return}})))}popActiveView(){const e=this.viewHistory.pop()||this._defaultView;e.type===o.Type.readersAttention&&(e.caller={type:o.ReadersAttention.Caller.Type.navigation}),this._activeView.set(e)}}},20555:(e,t,i)=>{i.r(t),i.d(t,{ProofitFeature:()=>q,ProofitGmailInProgressRequestTracker:()=>z,ProofitGmailIntegrationForComposeWindow:()=>M,ProofitGmailIntegrationForThreads:()=>O,ProofitTextReplacement:()=>k,ProofitViewInjector:()=>F.E});var o=i(2844),s=i(24209),n=i(76974),r=i(80900),a=i(77843),l=i(77176),u=i(85985),p=i(28043),d=i(16118),h=i(93497),c=i(50628),m=i(66310),g=i(17343),_=i(23063),f=i(41398),v=i(8473),y=i(78674),w=i(2768),b=i(13718),E=i(42833),I=i(523),C=i(75003),T=i(95572),P=i(11407),R=i(10247),S=i(74850),W=i(5817),x=i(38983);class q{constructor(e,t,i,a,_,f,v,y,w,b,E,I,C){this.layout=e,this._checkingStatus=t,this._geometryInvalidated=a,this._textObserver=_,this._gnar=f,this._state=v,this._felog=y,this._docId=w,this._submitRequestToApi=b,this._cancelRequestToApi=E,this._actions=I,this.textReplacement=C,this._subs=[],this._textChangesDuringReviewSubscription=null,this._calculateHighlightsRectsSubscription=null,this._available=x.h.create("unknown"),this._isEnglish=x.h.create("unknown"),this.inProgressTabMounted=x.h.create(!1),this._conflictingInProgressTabMounted=x.h.create(!1),this.quotaRemaining=x.h.create(0),this.requestInfo=x.h.create(q.INITIAL_REQUEST_INFO),this.requestDisabledInfo=x.h.create(null),this._log=S.Y.create(`Proofit - docId: ${w}`),this.turnaroundTime=this._state.view((e=>{var t,i;return null!==(i=null===(t=e.dynamicConfig.proofit)||void 0===t?void 0:t.turnaroundTime)&&void 0!==i?i:60})),this.layoutCreated=this.layout.pipe((0,l.U)((e=>null!==e))),this.hideProofitIntroPopup=this._state.view((e=>Boolean(e.page.seenProofitIntroPopup)||Boolean(e.page.sentProofitRequest))),this._quotaResetDate=this._state.view((e=>e.page.billingSubscriptionStatus)).view((e=>{var t;return"MONTHLY"===(null==e?void 0:e.billing_subscription_plan_period)&&null!==(t=e.billing_subscription_renewal_date)&&void 0!==t?t:null})),this.disableHowItWorksInfo=this._state.view((e=>Boolean(e.page.disableProofitHowItWorksInfo))),this._subs.push(this.layout.subscribe((e=>{e&&(this._subs.push(e.proofitInProgressTabLayout.mounted.subscribe((e=>this.inProgressTabMounted.set(e)))),this._subs.push(e.proofitInProgressTabLayout.conflictingTabMounted.subscribe((e=>this._conflictingInProgressTabMounted.set(e)))))}))),this._subs.push((0,o.aj)([this._available,this._isEnglish,this.quotaRemaining,this._quotaResetDate,i,this._conflictingInProgressTabMounted,this.requestInfo.view("status")]).pipe((0,l.U)((([e,t,i,o,s,n,r])=>r===R.eE.REVIEWING?null:r===R.eE.INITIAL?{reason:R.rS.CHECKING_INITIAL_AVAILABILITY}:0===i?{reason:R.rS.NO_FREE_TRIALS_LEFT,meta:{quotaResetDate:o}}:!1===t?{reason:R.rS.UNSUPPORTED_LANGUAGE}:i<0?{reason:R.rS.NOT_AVAILABLE_QUOTA_ERROR}:!1===e?{reason:R.rS.NOT_AVAILABLE}:n?{reason:R.rS.CONFLICTING_REQUEST}:s<R.fy?{reason:R.rS.NOT_ENOUGH_WORDS,meta:{wordsCount:s}}:s>R.Vw?{reason:R.rS.TOO_MANY_WORDS,meta:{wordsCount:s}}:null))).subscribe((e=>this.requestDisabledInfo.set(e)))),this._subs.push(this.requestDisabledInfo.pipe((0,l.U)((e=>{var t;return null!==(t=null==e?void 0:e.reason)&&void 0!==t?t:null})),(0,u.h)((e=>e!==R.rS.CHECKING_INITIAL_AVAILABILITY)),(0,p.x)()).subscribe((e=>{null===e?this._gnar.proofitButtonEnabled():this._gnar.proofitButtonDisabled(e)}))),this._subs.push(this.requestInfo.pipe((0,d.G)()).subscribe((([e,t])=>{this._log.trace("Request info changes (previous vs. new):",{previousRequestInfo:e,newRequestInfo:t})}))),this._subs.push((0,o.aj)([this._isEnglish,this._available]).pipe((0,h.n)((([e,t])=>"unknown"===e||"unknown"===t)),(0,c.P)()).subscribe((e=>{this.requestInfo.view("status").get()===R.eE.INITIAL&&this.requestInfo.modify((e=>({...e,status:R.eE.IDLE})))}))),this.startedThenStoppedTyping=this._textObserver.contentChanges.async.pipe((0,m.w)((e=>(0,s.T)((0,n.of)(e.changes.length>0),(0,r.H)((0,W.m9)(2)).pipe((0,g.h)(!1))))),(0,d.G)(),(0,l.U)((([e,t])=>!0===e&&!1===t)))}onAvailabilityData(e){this._log.trace("Availability response received:",e),this._available.set(e.quota>=0&&e.available),this.quotaRemaining.set(e.quota),e.quota<0&&this._felog.proofit.availabilityQuotaError(this._getDataForErrorTracking())}setIsEnglish(e){this._isEnglish.set(e)}onSubmitResponse(e){this._log.trace("Submit response received:",e),"error"===e.status?(this.requestInfo.set({...q.IDLE_REQUEST_INFO,status:R.eE.ERROR}),this._felog.proofit.submitResponseError(this._getDataForErrorTracking())):"accepted"===e.status&&this.requestInfo.modify((e=>({...e,status:R.eE.ACCEPTED})))}onCancelResponse(e){this._log.trace("Cancel response received:",e),this.quotaRemaining.set(e.quota),this.requestInfo.set({...q.IDLE_REQUEST_INFO,status:R.eE.CANCELED})}onProgress(e){this._log.trace("Request in progress message received:",e);const t=this.requestInfo.get().status;t!==R.eE.ACCEPTED&&t!==R.eE.IN_PROGRESS||(this.requestInfo.modify((t=>({...t,status:R.eE.IN_PROGRESS,slicesChecked:e.checked,totalSlices:e.total,suggestionsMade:e.changesNumber,activeReviewers:e.activeReviewers}))),t===R.eE.ACCEPTED&&this._subs.push((0,a.F)(1e3).pipe((0,_.q)(this.turnaroundTime.get()+1),(0,f.M)(this.requestInfo.view("status")),(0,v.o)((([e,t])=>t===R.eE.IN_PROGRESS)),(0,l.U)((([e,t])=>this.turnaroundTime.get()-e))).subscribe((e=>this.requestInfo.modify((t=>({...t,secondsRemaining:e})))))))}onCompleted(e){const t=this.requestInfo.get().timeStarted;if(t){const e=(Date.now()-t)/1e3;this._gnar.proofitOrderTurnaroundTimeInSeconds(e)}this._log.trace("Request completed message received:",e),this.requestInfo.modify((t=>({...t,status:R.eE.COMPLETED,slicesChecked:e.checked,totalSlices:e.total,suggestionsMade:e.changesNumber,textChanges:e.textChanges,timeStarted:void 0})))}onError(e){this._log.trace("Request error message received:",e),this.requestInfo.set({...q.IDLE_REQUEST_INFO,status:R.eE.ERROR}),this._felog.proofit.progressError(this._getDataForErrorTracking(e.reason))}onRejected(e){this._log.trace("Request rejected message received:",e),this.requestInfo.set({...q.IDLE_REQUEST_INFO,status:R.eE.REJECTED}),this._felog.proofit.progressRejected(this._getDataForErrorTracking(e.reason))}onCAPISessionStart(){this.requestInfo.get().status!==R.eE.ACCEPTED&&this.requestInfo.get().status!==R.eE.IN_PROGRESS||(this._log.trace('Submitting request again (with "reconnect: true")'),this._submitRequestToApi(!0))}resetRequest(){var e;this._log.trace("Resetting request."),null===(e=this._calculateHighlightsRectsSubscription)||void 0===e||e.unsubscribe(),this.requestInfo.set(q.IDLE_REQUEST_INFO)}submitRequest(){this._log.trace("Submitting request."),this._actions.sentProofitRequest();const e=Date.now();this.requestInfo.set({...q.IDLE_REQUEST_INFO,status:R.eE.PREPARING});const t=this._checkingStatus.pipe((0,y.b)(300),(0,u.h)((e=>e===T.Hq.idle)));(0,a.F)(100).pipe((0,w.R)(t)).subscribe({complete:()=>{this._submitRequestToApi(!1),this.requestInfo.set({...q.IDLE_REQUEST_INFO,status:R.eE.PRE_SUBMIT,timeStarted:e})}})}cancelRequest(){this._log.trace("Canceling request."),this._gnar.proofitOrderCanceled(),this._cancelRequestToApi(),this.requestInfo.modify((e=>({...e,timeStarted:void 0,status:R.eE.PRE_CANCEL})))}async reviewRequest(){var e,t;this._log.trace("Reviewing request."),this._gnar.proofitOrderReviewed(),this.requestInfo.modify((e=>({...e,status:R.eE.REVIEWING}))),null===(e=this._textChangesDuringReviewSubscription)||void 0===e||e.unsubscribe();const i=await this.textReplacement.applyTextChanges(this.requestInfo.get().textChanges);this._calculateHighlightsRects(i),null===(t=this._calculateHighlightsRectsSubscription)||void 0===t||t.unsubscribe(),this._calculateHighlightsRectsSubscription=this._geometryInvalidated.pipe((0,b.U)(P.S.hz10),(0,f.M)(this.requestInfo.view("highlights"))).subscribe((([e,t])=>{this._calculateHighlightsRects(t)})),this._subs.push(this._calculateHighlightsRectsSubscription),this._textChangesDuringReviewSubscription=this._textObserver.contentChanges.immediate.pipe((0,E.u)((0,r.H)(1e3)),(0,u.h)((e=>e.changes.length>0)),(0,c.P)()).subscribe((()=>this.resetRequest())),this._subs.push(this._textChangesDuringReviewSubscription)}_calculateHighlightsRects(e){const t=this.textReplacement.calculateHighlightsRects(e);this.requestInfo.modify((e=>({...e,highlights:t})))}dialogCallerInfo(){return this._isInReview()?{caller:I.Rx.proofitReview}:{caller:I.Rx.proofitRequest}}assistantViewType(){return this._isInReview()?C.aH.Type.proofitReview:C.aH.Type.proofitRequest}markSeenProofitIntroPopup(){this._actions.seenProofitIntroPopup(),this._gnar.proofitIntroPopupShow()}onDisableHowItWorksInfo(e){e?this._actions.disableProofitHowItWorksInfo():this._actions.enableProofitHowItWorksInfo()}dispose(){this._subs.forEach((e=>e.unsubscribe()))}_getDataForErrorTracking(e){var t,i;const o=this.requestInfo.get();return{reason:null!=e?e:null,featureState:{available:this._available.get(),quotaRemaining:this.quotaRemaining.get(),isEnglish:this._isEnglish.get(),requestInfo:{status:o.status,slicesChecked:o.slicesChecked,totalSlices:o.totalSlices,suggestionsMade:o.suggestionsMade},requestDisabledReason:null!==(i=null===(t=this.requestDisabledInfo.get())||void 0===t?void 0:t.reason)&&void 0!==i?i:null,docId:this._docId}}}_isInReview(){return this.requestInfo.get().status===R.eE.REVIEWING}}q.INITIAL_REQUEST_INFO={status:R.eE.INITIAL,slicesChecked:0,totalSlices:0,suggestionsMade:0,textChanges:[],highlights:[],activeReviewers:0},q.IDLE_REQUEST_INFO={...q.INITIAL_REQUEST_INFO,status:R.eE.IDLE};var L=i(62337),A=i(64450),D=i(36991);class k{constructor(e,t,i,o,s){this._getCurrentTextMap=t,this._geometryProvider=i,this._geometryLayout=o,this._replacementService=s,this._log=S.Y.create(`ProofitTextReplacement - docId: ${e}`)}calculateHighlightsRects(e){const t=e.map((e=>{const t=this._geometryProvider.create(e.range,this._getCurrentTextMap()),i=t?this._geometryProvider.getClientRects(t):[],o=(i?Array.from(i):[]).map((e=>L.UL.setPosition(this._geometryLayout.getCurrentConversionContext().clientToRelative(e),e)));return{...e,rects:o}}));return this._log.trace("Highlights rects calculated:",t),t}async applyTextChanges(e){var t;this._log.trace("Applying text changes:",e),this._log.trace("Text before changes:",`"${this._getCurrentTextMap().getPlainText()}"`);let i=0,o=[];for(const s of e){const e=s.context.s+i,n=s.context.e+i,r=await this._applyTextChangesToSlice(e,n,new A.i(null===(t=s.alternatives)||void 0===t?void 0:t[0]));i+=r.indexRebase,o=o.concat(r.highlights)}return this._log.trace("Text after changes:",`"${this._getCurrentTextMap().getPlainText()}"`),o}async _applyTextChangesToSlice(e,t,i){this._log.trace("Applying text changes to slice within the range:",`[${e}, ${t}]`),this._log.trace("Text in slice before changes:",this._getCurrentTextMap().getPlainText().slice(e,t+1));let o=e-1,s=0,n=null;const r=[];for(let e=0;e<i.ops.length;e++){const t=i.ops[e],a=o+1;let l=null,u=null,p=null;if(D.s.isRetain(t))o+=t.retain;else if(D.s.isInsertString(t)){const r=i.ops[e+1];r&&D.s.isDelete(r)?n=t:(l=a,u="",p=t.insert,o+=p.length,s+=p.length)}else D.s.isDelete(t)&&(l=a+t.delete,u=this._getCurrentTextMap().getPlainText().slice(a,a+t.delete),n?(p=n.insert,n=null):p="",o+=p.length,s=s+p.length-t.delete);if(null!==l&&null!==u&&null!==p){await this._replacementService.performReplacement({start:a,end:l},p,!1);const e={start:a,end:a+p.length};if(0===p.length){const t=this._getCurrentTextMap().getPlainText();" "===t[e.end]?e.end=e.end+1:" "===t[e.start-1]?e.start=e.start-1:t[e.end]?e.end=e.end+1:t[e.start-1]&&(e.start=e.start-1)}r.push({range:e,originalText:u,rects:[]})}}return this._log.trace("Text in slice after changes:",this._getCurrentTextMap().getPlainText().slice(0===e?e:e+s,t+s+1)),{indexRebase:s,highlights:r}}}class z{constructor(){this._inProgressId=x.h.create(null)}currentId(){return this._inProgressId.get()}sameRequestInProgress(e){return this._inProgressId.view((t=>Boolean(t)&&t===e))}differentRequestInProgress(e){return this._inProgressId.view((t=>Boolean(t)&&t!==e))}markInProgress(e){this._inProgressId.set(e)}markNotInProgress(){this._inProgressId.set(null)}}z.MESSAGE_ID=0,z.generateId=()=>{const e=`proofit-in-progress-${z.MESSAGE_ID}`;return z.MESSAGE_ID+=1,e};var N=i(84970),H=i(22679);class M{constructor(e,t,i){this._targetTextField=e,this._fieldContainer=t,this._inProgressRequestTracker=i,this._messageId=z.generateId()}getProofitLayout(){var e,t,i,o,s,n,r,a,l,u,p,d,h,c,m,g,_,f,v,y,w;const b=null===(i=null===(t=null===(e=this._targetTextField.closest("table"))||void 0===e?void 0:e.closest("table:not(:scope)"))||void 0===t?void 0:t.querySelector('[command="Files"]'))||void 0===i?void 0:i.closest("table"),E=null==b?void 0:b.querySelector("tr td:first-of-type");this._composeWindow=this._targetTextField.closest('[role="dialog"]'),this._composeWindowContent=null===(s=null===(o=this._composeWindow)||void 0===o?void 0:o.querySelector(":scope > .nH > .aaZ"))||void 0===s?void 0:s.parentElement,this._composeWindowLabel=null===(n=this._composeWindow)||void 0===n?void 0:n.querySelector(":scope > .nH.Hy.aXJ");const I=null===(a=null===(r=this._composeWindow)||void 0===r?void 0:r.querySelector('input[name="draft"]'))||void 0===a?void 0:a.value,C=I?null===(l=this._targetTextField.ownerDocument.querySelector(`[data-standalone-draft-id="${I}"]`))||void 0===l?void 0:l.closest("tr"):null;return this._draftItemLabel=null==C?void 0:C.querySelector(":scope > td.yX.xY > div.yW > span.bA4 > span.yP.boq"),this._fullscreenContainer=null===(u=this._composeWindow)||void 0===u?void 0:u.closest(".aVN"),this._fullscreenOverlay=null===(p=this._fullscreenContainer)||void 0===p?void 0:p.closest(".aSs"),this._minimizedComposeWindowContainerWrapperList=this._targetTextField.ownerDocument.querySelector(".dw > div > .nH > .nH > .no"),this._minimizedComposeWindowContainerWrapperListParent=null===(m=null===(c=null===(h=null===(d=this._minimizedComposeWindowContainerWrapperList)||void 0===d?void 0:d.parentElement)||void 0===h?void 0:h.parentElement)||void 0===c?void 0:c.parentElement)||void 0===m?void 0:m.parentElement,this._minimizedComposeWindowContainerWrapper=this._fullscreenContainer?Array.from(null!==(_=null===(g=this._minimizedComposeWindowContainerWrapperList)||void 0===g?void 0:g.querySelectorAll(":scope > .nH.nn"))&&void 0!==_?_:[]).find((e=>{const t=e.querySelector(":scope > .no > .nH.nn > .AD > .Hd");return Boolean(t&&!t.hasChildNodes())})):null===(y=null===(v=null===(f=this._composeWindow)||void 0===f?void 0:f.closest(".nH.nn"))||void 0===v?void 0:v.parentElement)||void 0===y?void 0:y.closest(".nH.nn"),this._minimizedComposeWindowContainer=null===(w=this._minimizedComposeWindowContainerWrapper)||void 0===w?void 0:w.querySelector(":scope > .no > .nH.nn"),this._hubspotSalesExtensionSidebarWidget=this._targetTextField.ownerDocument.querySelector(".hubspot.hubspot-sales-sidebar-tab-container"),b&&E&&this._composeWindow&&this._composeWindowContent&&this._minimizedComposeWindowContainerWrapperList&&this._minimizedComposeWindowContainerWrapper&&this._minimizedComposeWindowContainer?{proofitButtonLayout:{sibling:E,popupStyle:{zIndex:1}},proofitInProgressTabLayout:{container:this._minimizedComposeWindowContainer,mounted:this._inProgressRequestTracker.sameRequestInProgress(this._messageId),onMount:()=>this._onMountInProgressTab(),onUnmount:()=>this._onUnmountInProgressTab(),style:{position:"absolute",bottom:0,right:0,visibility:"visible"},conflictingTabMounted:this._inProgressRequestTracker.differentRequestInProgress(this._messageId),shouldLimitInteraction:Boolean(this._fullscreenContainer)},proofitHighlightsLayout:{container:this._fieldContainer,style:{position:"absolute",zIndex:H.wJ}},proofitInProgressDraftItemLayout:{clientRect:!this._fullscreenContainer&&C?N.z.createShared(C):null,style:{position:"fixed",backgroundColor:C?getComputedStyle(C).backgroundColor:"rgba(242,245,245,0.8)",opacity:.5}}}:null}_onMountInProgressTab(){var e,t;if(this._composeWindow&&this._composeWindowContent&&this._minimizedComposeWindowContainerWrapperList&&this._minimizedComposeWindowContainerWrapper&&this._minimizedComposeWindowContainer){if(this._inProgressRequestTracker.currentId()===this._messageId)return;if(this._fullscreenContainer){if(this._minimizedComposeWindowContainerWrapper.style.display="block",this._fullscreenContainer.style.display="none",this._fullscreenOverlay){const t=getComputedStyle(this._fullscreenOverlay),i=this._targetTextField.ownerDocument.createElement("div");i.style.backgroundColor=t.backgroundColor,i.style.height="100%",i.style.width="100%",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.zIndex=t.zIndex,i.setAttribute("data-grammarly-proofit-in-progress-overlay","true"),this._fullscreenOverlay.style.visibility="hidden",null===(e=this._minimizedComposeWindowContainerWrapperListParent)||void 0===e||e.insertAdjacentElement("beforebegin",i),this._hubspotSalesExtensionSidebarWidget&&(this._hubspotSalesExtensionSidebarWidget.style.visibility="hidden")}null===(t=this._minimizedComposeWindowContainerWrapperList)||void 0===t||t.querySelectorAll(":scope > .nH.nn").forEach((e=>{e!==this._minimizedComposeWindowContainerWrapper&&(e.style.opacity="0.5",e.style.pointerEvents="none")}))}else this._composeWindowLabel&&(this._composeWindowLabel.style.display="none");this._draftItemLabel&&(this._draftItemLabel.innerHTML="Expert review in progress"),this._minimizedComposeWindowContainerWrapper.style.height="100vh",this._minimizedComposeWindowContainer.style.height="100vh",this._minimizedComposeWindowContainer.style.zIndex="2",this._composeWindowContent.style.display="none",this._composeWindow.setAttribute("data-grammarly-proofit-in-progress-compose-window-container-width",this._minimizedComposeWindowContainer.style.width),this._composeWindow.setAttribute("data-grammarly-proofit-in-progress-compose-window-container-wrapper-width",this._minimizedComposeWindowContainerWrapper.style.width),this._minimizedComposeWindowContainer.style.width="260px",this._minimizedComposeWindowContainerWrapper.style.width="265px",this._inProgressRequestTracker.markInProgress(this._messageId)}}_onUnmountInProgressTab(){var e;if(this._composeWindow&&this._composeWindowContent&&this._minimizedComposeWindowContainerWrapperList&&this._minimizedComposeWindowContainerWrapper&&this._minimizedComposeWindowContainer){if(this._inProgressRequestTracker.currentId()!==this._messageId)return;this._fullscreenContainer?(this._minimizedComposeWindowContainerWrapper.style.display="none",this._fullscreenContainer.style.display="block",this._fullscreenOverlay&&(this._fullscreenOverlay.style.visibility="inherit",null===(e=this._targetTextField.ownerDocument.body.querySelector('div[data-grammarly-proofit-in-progress-overlay="true"]'))||void 0===e||e.remove()),this._minimizedComposeWindowContainerWrapperList.querySelectorAll(":scope > .nH.nn").forEach((e=>{e.style.opacity="initial",e.style.pointerEvents="initial"})),this._hubspotSalesExtensionSidebarWidget&&(this._hubspotSalesExtensionSidebarWidget.style.visibility="visible")):this._composeWindowLabel&&(this._composeWindowLabel.style.display="block"),this._draftItemLabel&&(this._draftItemLabel.innerHTML="Draft"),this._minimizedComposeWindowContainer.style.zIndex="auto",this._composeWindowContent.style.display="block";const t=this._composeWindow.getAttribute("data-grammarly-proofit-in-progress-compose-window-container-width"),i=this._composeWindow.getAttribute("data-grammarly-proofit-in-progress-compose-window-container-wrapper-width");t&&i&&(this._minimizedComposeWindowContainer.style.width=t,this._minimizedComposeWindowContainerWrapper.style.width=i),this._composeWindow.removeAttribute("data-grammarly-proofit-in-progress-compose-window-container-width"),this._composeWindow.removeAttribute("data-grammarly-proofit-in-progress-compose-window-container-wrapper-width"),this._inProgressRequestTracker.markNotInProgress(),this._targetTextField.focus()}}}class O{constructor(e,t,i){this._targetTextField=e,this._fieldContainer=t,this._inProgressRequestTracker=i,this._progressMessageElement=null,this._hideComposeTab=e=>{var t;e.setAttribute("data-grammarly-proofit-in-progress-compose-window-wrapper-display",null!==(t=e.style.display)&&void 0!==t?t:"inherit"),e.style.display="none"},this._showComposeTab=e=>{var t;const i="data-grammarly-proofit-in-progress-compose-window-wrapper-display",o=null!==(t=e.getAttribute(i))&&void 0!==t?t:"";e.style.display=o,e.removeAttribute(i)},this._messageId=z.generateId()}getProofitLayout(){var e,t,i,o,s,n,r,a,l,u;const p=null===(i=null===(t=null===(e=this._targetTextField.closest("table"))||void 0===e?void 0:e.closest("table:not(:scope)"))||void 0===t?void 0:t.querySelector('[command="Files"]'))||void 0===i?void 0:i.closest("table"),d=null==p?void 0:p.querySelector("tr td:first-of-type");return this._composeWindow=this._targetTextField.closest('[role="region"]'),this._composeWindowContent=null===(o=this._composeWindow)||void 0===o?void 0:o.querySelector(":scope > table.HM > tbody > tr > td.I5"),this._fullscreenOverlay=document.querySelector(".aSs"),this._minimizedComposeWindowContainerWrapperList=this._targetTextField.ownerDocument.querySelector(".dw > div > .nH > .nH > .no"),this._minimizedComposeWindowContainerWrapperListParent=null===(a=null===(r=null===(n=null===(s=this._minimizedComposeWindowContainerWrapperList)||void 0===s?void 0:s.parentElement)||void 0===n?void 0:n.parentElement)||void 0===r?void 0:r.parentElement)||void 0===a?void 0:a.parentElement,this._minimizedComposeWindowContainerWrapper=Array.from(null!==(u=null===(l=this._minimizedComposeWindowContainerWrapperList)||void 0===l?void 0:l.querySelectorAll(":scope > .nH.nn"))&&void 0!==u?u:[]).find((e=>!e.hasChildNodes()&&"2147483647"!==e.style.order)),this._hubspotSalesExtensionSidebarWidget=this._targetTextField.ownerDocument.querySelector(".hubspot.hubspot-sales-sidebar-tab-container"),p&&d&&this._composeWindow&&this._composeWindowContent&&this._minimizedComposeWindowContainerWrapperList&&this._minimizedComposeWindowContainerWrapper&&this._minimizedComposeWindowContainerWrapperListParent?{proofitButtonLayout:{sibling:d,popupStyle:{zIndex:1}},proofitInProgressTabLayout:{container:this._minimizedComposeWindowContainerWrapper,mounted:this._inProgressRequestTracker.sameRequestInProgress(this._messageId),onMount:()=>this._onMountInProgressTab(),onUnmount:()=>this._onUnmountInProgressTab(),style:{position:"absolute",bottom:0,right:66,visibility:"visible"},conflictingTabMounted:this._inProgressRequestTracker.differentRequestInProgress(this._messageId),shouldLimitInteraction:!0},proofitHighlightsLayout:{container:this._fieldContainer,style:{position:"absolute",zIndex:H.wJ}},proofitInProgressDraftItemLayout:null}:null}_onMountInProgressTab(){if(this._composeWindow&&this._composeWindowContent&&this._minimizedComposeWindowContainerWrapperList&&this._minimizedComposeWindowContainerWrapper&&this._minimizedComposeWindowContainerWrapperListParent){if(this._inProgressRequestTracker.currentId()===this._messageId)return;this._addFullScreenOverlay(),this._allComposeTabContainers().forEach((e=>this._hideComposeTab(e))),this._minimizedComposeWindowContainerWrapperListParent.style.top="0",this._minimizedComposeWindowContainerWrapperListParent.style.position="absolute",this._minimizedComposeWindowContainerWrapperListParent.style.zIndex=H.wJ.toString(),this._hideComposeWindowContent(),this._inProgressRequestTracker.markInProgress(this._messageId)}}_onUnmountInProgressTab(){if(this._composeWindow&&this._composeWindowContent&&this._minimizedComposeWindowContainerWrapperList&&this._minimizedComposeWindowContainerWrapper&&this._minimizedComposeWindowContainerWrapperListParent){if(this._inProgressRequestTracker.currentId()!==this._messageId)return;this._removeFullScreenOverlay(),this._allComposeTabContainers().forEach((e=>this._showComposeTab(e))),this._minimizedComposeWindowContainerWrapper.style.height="",this._minimizedComposeWindowContainerWrapperListParent.style.top="",this._minimizedComposeWindowContainerWrapperListParent.style.position="",this._minimizedComposeWindowContainerWrapperListParent.style.zIndex="",this._composeWindowContent.style.display="block",this._progressMessageElement&&(this._progressMessageElement.remove(),this._progressMessageElement=null),this._inProgressRequestTracker.markNotInProgress(),this._targetTextField.focus()}}_allComposeTabContainers(){var e,t;return Array.from(null!==(t=null===(e=this._minimizedComposeWindowContainerWrapperList)||void 0===e?void 0:e.querySelectorAll(":scope > .nH.nn > .no"))&&void 0!==t?t:[])}_hideComposeWindowContent(){var e;this._composeWindowContent&&(this._composeWindowContent.style.display="none",this._progressMessageElement=this._buildProgressMessageElement(),null===(e=this._composeWindowContent.parentElement)||void 0===e||e.appendChild(this._progressMessageElement))}_buildProgressMessageElement(){const e=this._targetTextField.ownerDocument.createElement("div");return e.style.background="#F5F5F5",e.style.borderRadius="2px",e.style.color="#777",e.style.marginLeft="8px",e.style.marginTop="12px",e.style.padding="7px",e.textContent="Your email is being reviewed by our experts.",e}_addFullScreenOverlay(){var e;const t=this._targetTextField.ownerDocument.createElement("div");if(t.style.height="100%",t.style.width="100%",t.style.position="absolute",t.style.top="0",t.style.left="0",t.setAttribute("data-grammarly-proofit-in-progress-overlay","true"),this._fullscreenOverlay){const e=getComputedStyle(this._fullscreenOverlay);t.style.backgroundColor=e.backgroundColor,t.style.zIndex=e.zIndex,this._fullscreenOverlay.style.visibility="hidden"}else t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.zIndex="6";null===(e=this._minimizedComposeWindowContainerWrapperListParent)||void 0===e||e.insertAdjacentElement("beforebegin",t),this._hubspotSalesExtensionSidebarWidget&&(this._hubspotSalesExtensionSidebarWidget.style.visibility="hidden")}_removeFullScreenOverlay(){var e;null===(e=this._targetTextField.ownerDocument.body.querySelector('div[data-grammarly-proofit-in-progress-overlay="true"]'))||void 0===e||e.remove(),this._hubspotSalesExtensionSidebarWidget&&(this._hubspotSalesExtensionSidebarWidget.style.visibility="visible")}}var F=i(61891)},2775:(e,t,i)=>{i.r(t),i.d(t,{ProofitButtonView:()=>se,ProofitHighlightsView:()=>we,ProofitInProgressDraftItemOverlayView:()=>Ee,ProofitInProgressTabView:()=>me,ProofitViewInjector:()=>ne.E});var o=i(27378),s=i(75003),n=i(10247),r=i(67521),a=i(20855),l=i(3860),u=i(2005),p=i(12187),d=i(50258),h=i(99369);const c=({headerIcon:e,title:t,message:i,children:s,show:n,placement:r,onClose:a,style:l})=>o.createElement(u.J,{headerContent:o.createElement("div",{...(0,p.Sh)("logo"===e?d.popoverMessageHeaderContentLogoIcon:null,"logo-with-name"===e?d.popoverMessageHeaderContentLogoWithNameIcon:null,"logo-error"===e?d.popoverMessageHeaderContentLogoErrorIcon:null,"notification-ok"===e?d.popoverMessageHeaderContentNotificationOKIcon:null,"notification-warning"===e?d.popoverMessageHeaderContentNotificationWarningIcon:null)}),mainContent:o.createElement("div",{className:h.popoverMessageMainContent},o.createElement("div",{className:h.popoverMessageMainContentTitle},t),i&&o.createElement("div",{className:h.popoverMessageMainContentText},i)),show:n,placement:r,onClose:a,style:l},s);var m;c.defaultProps={headerIcon:"logo-with-name",placement:"auto",show:!1},function(e){e.emphasizedToEnabled="emphasizedToEnabled",e.enabledToEnabled="enabledToEnabled",e.emphasized="emphasized",e.disabled="disabled",e.enabled="enabled"}(m||(m={}));var g=i(81108),_=i(90361),f=i(34685),v=i(63969);const y=96,w=v.u.keyframes({from:{backgroundPosition:"0 0"},to:{backgroundPosition:`${v.u.px(-3264)} 0`}}),b={height:v.u.px(y),width:v.u.px(y),transformOrigin:"top left"},E={width:y,height:y,backgroundImage:`url(${f.yr}proofitColorChange.png)`,animation:`${w} ${v.u.seconds(2)} steps(34) forwards 1`,animationFillMode:"forwards"},I={width:y,height:y,backgroundImage:`url(${f.yr}proofitColorChange.png)`,backgroundPosition:[0,0]},C={width:y,height:y,backgroundImage:`url(${f.yr}proofitColorChange.png)`,backgroundPosition:[0,-3264]},T=v.u.style(E),P=v.u.style(C),R=v.u.style(I),S=v.u.style(b),W=({size:e})=>o.createElement("div",{style:{height:e,width:e}},o.createElement("div",{className:S,style:{transform:`scale(${e/y})`}},o.createElement("div",{className:T}))),x=({size:e})=>o.createElement("div",{style:{height:e,width:e}},o.createElement("div",{className:S,style:{transform:`scale(${e/y})`}},o.createElement("div",{className:P}))),q=({size:e})=>o.createElement("div",{style:{height:e,width:e}},o.createElement("div",{className:S,style:{transform:`scale(${e/y})`}},o.createElement("div",{className:R}))),L=96,A=v.u.keyframes({from:{backgroundPosition:"0 0"},to:{backgroundPosition:`${v.u.px(-8544)} 0`}}),D={height:v.u.px(L),width:v.u.px(L),transformOrigin:"top left"},k={width:L,height:L,backgroundImage:`url(${f.yr}proofitSparkle.png)`,animation:`${A} ${v.u.seconds(2)} steps(89) forwards 1`,animationFillMode:"forwards"},z=v.u.style(k),N=v.u.style(D),H=({size:e})=>o.createElement("div",{style:{height:e,width:e}},o.createElement("div",{className:N,style:{transform:`scale(${e/L})`}},o.createElement("div",{className:z})));var M=i(36208);function O(e){const t=o.useRef();return o.useEffect((()=>{t.current=e})),t.current}const F=({prevIsDisabled:e,isDisabled:t,prevIsEmphasized:i,isEmphasized:s})=>{const n=(a=t,l=i,u=s,(r=e)||!l||a||u?r||l||a||u?u?m.emphasized:a?m.disabled:m.enabled:m.enabledToEnabled:m.emphasizedToEnabled);var r,a,l,u;switch(n){case m.emphasizedToEnabled:case m.enabledToEnabled:return o.createElement(x,{size:20});case m.enabled:return o.createElement(W,{size:20});case m.emphasized:return o.createElement(H,{size:20});case m.disabled:return o.createElement(q,{size:20});default:(0,_.vE)(n)}},V=({style:e,onClick:t,disabledInfo:i,isEmphasized:s,showPopup:n,onPopupClose:r,disableIntroTooltip:u,popupStyle:p})=>{var d,h;const m=Boolean(i),_=null===(d=O(m))||void 0===d||d,f=null!==(h=O(s))&&void 0!==h&&h,v=o.createElement("div",{"data-grammarly-part":"proofit-button",className:M.proofitButtonIcon,style:e},o.createElement(l.h,{onClick:t,disabled:m},o.createElement(F,{isDisabled:m,prevIsDisabled:_,isEmphasized:s,prevIsEmphasized:f})));if(m)return o.createElement(a.u,{showDelay:0,message:o.createElement(g.Q,{info:i,includeTitle:!0}),withGrammarlyIcon:!0},v);if(n){let e,t,i="";return"canceled"===n?(e="logo-with-name",i="Your request was canceled."):"error"===n?(e="logo-error",i="Something went wrong.",t="Please try again later."):"rejected"===n?(e="logo-error",i="Order canceled by writing experts.",t=o.createElement(o.Fragment,null,o.createElement("a",{target:"_blank",href:"https://support.grammarly.com/hc/en-us/articles/360024803951-Expert-writing-service-submission-stand"},"See our submission guidelines"),". We'll refund your credit to use on a different email.")):"intro"===n&&(e="logo-with-name",i="Are you writing an important email?",t="Learn how to get instant help from our team of writing experts."),o.createElement(c,{show:Boolean(n),title:i,message:t,onClose:r,placement:"top",headerIcon:e,style:p},v)}return o.createElement(a.u,{showDelay:1e3,message:o.createElement(o.Fragment,null,o.createElement("b",null,"Are you writing an important email?"),o.createElement("br",null),"Learn how to get instant help from our team of writing experts."),withGrammarlyIcon:!0,disabled:u},v)};V.defaultProps={disabledInfo:null,disableIntroTooltip:!1};var U=i(98403),B=i(16118),G=i(2844),$=i(85985),j=i(23063),Q=i(71032),Y=i(17343),J=i(24209),K=i(76974),X=i(80900),Z=i(93508),ee=i(2834),te=i(77176),ie=i(38983),oe=i(5739);const se=({layout:e,gButtonIsVisible:t,gButtonHasNoConflictingPopupOrBanner:i,requestDisabledInfo:a,requestStatus:l,assistantActiveView:u,onOpenAssistant:p,onCloseAssistant:d,hideProofitIntroPopup:h,markSeenProofitIntroPopup:c,startedThenStoppedTyping:m,mouseObservable:g})=>{const[_,f]=o.useState(!1);o.useEffect((()=>{const e=l.pipe(B.G()).subscribe((([e,t])=>{const i=e!==n.eE.CANCELED&&t===n.eE.CANCELED,o=e!==n.eE.ERROR&&t===n.eE.ERROR,s=e!==n.eE.REJECTED&&t===n.eE.REJECTED;f(i?"canceled":o?"error":!!s&&"rejected")}));return()=>e.unsubscribe()}),[]),o.useEffect((()=>{const e=G.aj([i,a,h,m,l]).pipe($.h((([e,t,i,o,s])=>!i&&e&&null===t&&o&&s===n.eE.IDLE)),j.q(1)).subscribe((()=>{f("intro"),c()}));return()=>e.unsubscribe()}),[]);const v=ie.h.create(!1);return(0,r.A)(G.aj([a,m]).pipe($.h((([e,t])=>null===e&&!0===t)),j.q(1),Q.b((()=>g.pipe(Y.h(!0),j.q(1)))),Q.b((()=>J.T(K.of(!0),X.H(4e3).pipe(Y.h(!1),j.q(1))))),Z.O(!1),ee.b(U.wW(v)))),o.createElement(oe.F.Fragment,null,G.aj([e.pipe(te.U((e=>null==e?void 0:e.proofitButtonLayout))),t,a,l,u,v]).pipe(te.U((([e,t,i,r,a,l])=>e&&t?o.createElement(V,{style:{marginLeft:12,marginTop:4},onClick:()=>{f(!1),(null==a?void 0:a.type)===s.aH.Type.proofitRequest||(null==a?void 0:a.type)===s.aH.Type.proofitReview?d():p()},showPopup:_,onPopupClose:()=>f(!1),disabledInfo:i,disableIntroTooltip:r!==n.eE.IDLE||(null==a?void 0:a.type)===s.aH.Type.proofitRequest||(null==a?void 0:a.type)===s.aH.Type.proofitReview,popupStyle:e.popupStyle,isEmphasized:l}):null))))};var ne=i(61891),re=i(53112),ae=i(24606),le=i(64229),ue=i(8513),pe=i(8385),de=i(28573);const he=e=>{const t=e=>{let t=Math.round(e);return t>100?t=100:t<0&&(t=0),t},i=e.isCompleted?null:60===e.turnaroundTime?"1 minute":`${e.turnaroundTime} seconds`;return o.createElement("div",{"data-grammarly-part":"proofit-in-progress-tab",style:e.style},o.createElement("div",{className:de.proofitInProgressTab},o.createElement("div",{className:de.proofitInProgressTabContent},o.createElement("div",{...(0,p.Sh)(de.proofitInProgressTabTitleContainer,e.secondaryTitle?de.proofitInProgressTabTitleContainerMultiple:null)},o.createElement("span",{...(0,p.Sh)(de.proofitInProgressTabTitle,de.proofitInProgressTabTitleMain)},e.title),e.secondaryTitle?o.createElement("span",{...(0,p.Sh)(de.proofitInProgressTabTitle,de.proofitInProgressTabTitleSecondary)},e.secondaryTitle):null),e.isCompleted?o.createElement(ae.z,{onClick:e.onReview,kind:"success",size:"small"},"Review"):t(e.progress)<100?o.createElement(le.m,{ariaMenuId:"proofit-in-progress-tab-actions-menu",ariaMenuLabel:"Proofit In-Progress Tab Actions Menu",items:[e.allowCancellation?{icon:o.createElement(ue.n,{color:re.Z.neutral50}),label:"Cancel order",onClick:e.onCancel}:{icon:o.createElement(ue.n,{color:re.Z.neutral40}),label:"Cancel order",disabled:!0,tooltip:`Request cancellation is available only if the review takes more than ${i}.`}],placement:"top-end",onToggle:e.onToggleMenu},o.createElement(l.h,{kind:"transparent"},o.createElement("div",{className:pe.proofitInProgressTabMenuIcon}))):null),e.isCompleted||e.hideProgressBar?null:o.createElement("div",{className:de.proofitInProgressTabCompletionBar,style:{width:`${t(e.progress)}%`}})))};var ce=i(18208);const me=({layout:e,requestInfo:t,turnaroundTime:i,onCancel:s,onReview:r})=>{const[a,l]=o.useState(null),[u,p]=o.useState(null),[d,h]=o.useState(null),[m,g]=o.useState(null),_=[n.eE.ACCEPTED,n.eE.IN_PROGRESS,n.eE.COMPLETED];return o.createElement(oe.F.Fragment,null,G.aj([e.pipe(te.U((e=>null==e?void 0:e.proofitInProgressTabLayout))),t,i]).pipe(ee.b((([e,t])=>{e&&_.includes(t.status)?e.onMount():e&&!_.includes(t.status)&&(e.onUnmount(),l(null),h(null),u&&clearTimeout(u),m&&clearTimeout(m))})),te.U((([e,t,i])=>{var u;const{suggestionsMade:m,slicesChecked:f,totalSlices:v,status:y,secondsRemaining:w,activeReviewers:b}=t;if(e&&_.includes(t.status)){const t=y===n.eE.ACCEPTED,_=y===n.eE.IN_PROGRESS,E=y===n.eE.COMPLETED;let I=0;v>0&&(I=f/v*100);let C,T="",P=!0;if(t)T="Connecting you to experts...";else if(_){T=m>0?`${m} ${ce._6(m,"suggestion","suggestions")} made so far...`:"Review in progress...";const e=null!=w?w:i;P=e>0,C=P?b>0?`${b} ${ce._6(b,"expert","experts")} reviewing...`:`About ${e} ${ce._6(e,"second","seconds")} remaining...`:"Wrapping up..."}else T=`${m} ${ce._6(m,"suggestion","suggestions")}`;let R,S,W="";return E?null===d?(l(!1),h(!0),g(setTimeout((()=>h(!1)),7e3))):d&&(W="Your email is ready!",R="Suggestions are highlighted.",S=()=>h(!1)):null===a?(l(!0),p(setTimeout((()=>l(!1)),7e3))):a&&(W="We're reviewing your email now.",R=o.createElement(o.Fragment,null,"This takes just a few moments.",e.shouldLimitInteraction?o.createElement(o.Fragment,null,o.createElement("br",null),"This page is temporarily paused while the experts review your email."):null),S=()=>l(!1)),o.createElement("div",{style:{...e.style}},o.createElement(c,{show:null!==(u=a||d)&&void 0!==u?u:void 0,title:W,message:R,onClose:S,placement:"top",headerIcon:d?"notification-ok":void 0},E?o.createElement(he,{isCompleted:E,title:T,onReview:r}):o.createElement(he,{isCompleted:E,title:T,secondaryTitle:C,progress:I,onCancel:s,onToggleMenu:e=>{e&&(null==S||S())},hideProgressBar:!P,allowCancellation:!P,turnaroundTime:i})))}return null}))))};var ge=i(52940),_e=i.n(ge),fe=i(99908),ve=i.n(fe);const ye=({originalText:e,width:t,height:i,top:s,left:n,zIndex:r,position:l})=>o.createElement("div",{"data-grammarly-part":"proofit-highlight",style:{width:t,height:i,top:s,left:n,zIndex:r,position:l}},o.createElement(a.u,{showDelay:0,message:o.createElement("div",{className:ve().proofitHighlightTooltip},e),disabled:0===e.trim().length},o.createElement("div",{className:_e().proofitHighlight})));ye.defaultProps={zIndex:"auto",position:"fixed"};const we=({layout:e,requestInfo:t,assistantActiveView:i})=>o.createElement(oe.F.Fragment,null,G.aj([e.pipe(te.U((e=>null==e?void 0:e.proofitHighlightsLayout.style))),t,i]).pipe(te.U((([e,t,i])=>(null==i?void 0:i.type)===s.aH.Type.proofitReview&&e&&t.status===n.eE.REVIEWING?t.highlights.map((t=>t.rects.map((i=>o.createElement(ye,{key:`${t.originalText}-${t.range.start}-${t.range.end}`,originalText:t.originalText,top:i.top,left:i.left,height:i.height,width:i.width,position:e.position,zIndex:e.zIndex}))))):null))));var be=i(66310);const Ee=({layout:e,requestInfo:t})=>{const i=[n.eE.ACCEPTED,n.eE.IN_PROGRESS,n.eE.COMPLETED];return o.createElement(oe.F.Fragment,null,G.aj([e.pipe(te.U((e=>null==e?void 0:e.proofitInProgressDraftItemLayout))).pipe(be.w((e=>{var t,i;return null!==(i=null===(t=null==e?void 0:e.clientRect)||void 0===t?void 0:t.pipe(Z.O(null)))&&void 0!==i?i:K.of(null)}))),e.pipe(te.U((e=>{var t;return null===(t=null==e?void 0:e.proofitInProgressDraftItemLayout)||void 0===t?void 0:t.style}))),t.view("status")]).pipe(te.U((([e,t,s])=>e&&t&&i.includes(s)?o.createElement(a.u,{showDelay:1e3,message:o.createElement(o.Fragment,null,o.createElement("b",null,"We're reviewing your email now."),o.createElement("br",null),"This will take just a few moments. We've temporarily paused your draft while the experts work on it."),withGrammarlyIcon:!0},o.createElement("div",{"data-grammarly-part":"proofit-in-progress-draft-item-overlay",style:{top:e.top,left:e.left,width:e.width,height:e.height,...t}})):null))))}},61891:(e,t,i)=>{i.d(t,{E:()=>a});var o=i(27378),s=i(18505),n=i(2780),r=i(68383);class a{constructor(e,t,i){this._outerDoc=e,this._proofitLayout=t,this._proofitElements=i,this._proofitButtonView=void 0,this._proofitInProgressTabView=void 0,this._proofitInProgressDraftItemOverlayView=void 0,this._proofitHighlightsView=void 0}inject(e){this._proofitButtonView=s.VB.get({monitorAs:"proofit-button"}).inject(n.EM.fromDocument(this._outerDoc,"grammarly-proofit-button"),(e=>{var t;e.style.zIndex="1",null===(t=this._proofitLayout)||void 0===t||t.proofitButtonLayout.sibling.insertAdjacentElement("afterend",e)}),r.G7.showWhenLoaded(o.createElement(this._proofitElements.proofitButton,null))),this._proofitInProgressTabView=s.VB.get({monitorAs:"proofit-in-progress-tab"}).inject(n.EM.fromDocument(this._outerDoc,"grammarly-proofit-in-progress-tab"),(e=>{var t;null===(t=this._proofitLayout)||void 0===t||t.proofitInProgressTabLayout.container.appendChild(e)}),r.G7.showWhenLoaded(o.createElement(this._proofitElements.proofitInProgressTab,null))),this._proofitInProgressDraftItemOverlayView=s.VB.get({monitorAs:"proofit-in-progress-draft-item-overlay"}).inject(n.EM.fromDocument(this._outerDoc,"grammarly-proofit-in-progress-draft-item-overlay"),n.zs.appendChild(this._outerDoc.documentElement),r.G7.showWhenLoaded(o.createElement(this._proofitElements.proofitInProgressDraftItemOverlay,null)),{eventPropagationHandler:null==e?void 0:e.eventPropagationHandler}),this._proofitHighlightsView=s.VB.get({monitorAs:"proofit-highlights"}).inject(n.EM.fromDocument(this._outerDoc,"grammarly-proofit-highlights"),(e=>{var t,i;null===(i=null===(t=this._proofitLayout)||void 0===t?void 0:t.proofitHighlightsLayout.container)||void 0===i||i.appendChild(e)}),r.G7.showWhenLoaded(o.createElement(this._proofitElements.proofitHighlights,null)))}dispose(){var e,t,i,o;null===(e=this._proofitButtonView)||void 0===e||e.dispose(),null===(t=this._proofitInProgressTabView)||void 0===t||t.dispose(),null===(i=this._proofitInProgressDraftItemOverlayView)||void 0===i||i.dispose(),null===(o=this._proofitHighlightsView)||void 0===o||o.dispose()}}},81108:(e,t,i)=>{i.d(t,{Q:()=>a});var o=i(27378),s=i(90361),n=i(10247);const r=e=>{if(e.reason===n.rS.NO_FREE_TRIALS_LEFT){const t="No email reviews left this month";let i;if(e.meta.quotaResetDate){const t=Intl.DateTimeFormat([],{month:"short",day:"numeric"}).format(new Date(Date.parse(e.meta.quotaResetDate)));i=`You will get ${n.SR} free reviews again next month (${t}). You can also use paid expert writing help in Grammarly's web editor anytime.`}else i=`You will get ${n.SR} free reviews again next month. You can also use paid expert writing help in Grammarly's web editor anytime.`;return{title:t,message:i}}return e.reason===n.rS.NOT_ENOUGH_WORDS?{message:`Your email must be at least ${n.fy} words (currently ${e.meta.wordsCount}).`}:e.reason===n.rS.TOO_MANY_WORDS?{message:`Your email must be under ${n.Vw} words (currently ${e.meta.wordsCount}).`}:(e=>{switch(e){case n.rS.NOT_AVAILABLE:return{message:"Our experts are currently working on other text. Please try again later."};case n.rS.NOT_AVAILABLE_QUOTA_ERROR:return{title:"Something went wrong",message:"We couldn't determine how many requests you have left. Please try again later."};case n.rS.CONFLICTING_REQUEST:return{title:"Separate request in progress",message:"You can submit this request once the experts are finished with the one you already submitted."};case n.rS.CHECKING_INITIAL_AVAILABILITY:return{message:"Checking for available experts..."};case n.rS.UNSUPPORTED_LANGUAGE:return{message:"Our writing experts can only help with emails written in English."};default:(0,s.vE)(e)}})(e.reason)},a=({info:e,includeTitle:t})=>{const i=r(e);return o.createElement(o.Fragment,null,t?o.createElement(o.Fragment,null,i.title?o.createElement("b",null,i.title):o.createElement("b",null,"Get expert writing help"),o.createElement("br",null)):null,i.message)};a.defaultProps={includeTitle:!1}},50258:e=>{e.exports={popoverMessageHeaderContentLogoIcon:"_2yKay",popoverMessageHeaderContentLogoWithNameIcon:"jdCoy",popoverMessageHeaderContentLogoErrorIcon:"SX3B2",popoverMessageHeaderContentNotificationOKIcon:"_2-xM4",popoverMessageHeaderContentNotificationWarningIcon:"_1hdvB",spin:"_29C-s"}},99369:e=>{e.exports={popoverMessageMainContent:"ox2NE",popoverMessageMainContentTitle:"_3f46g",popoverMessageMainContentText:"XiFNt"}},36208:e=>{e.exports={proofitButtonIcon:"_2QVlA"}},52940:e=>{e.exports={proofitHighlight:"_1az99"}},99908:e=>{e.exports={proofitHighlightTooltip:"_1DQoQ"}},8385:e=>{e.exports={proofitInProgressTabMenuIcon:"_1_mce",spin:"_3PjGK"}},28573:e=>{e.exports={proofitInProgressTab:"Q14bt",proofitInProgressTabContent:"_1jG5W",proofitInProgressTabTitleContainer:"_4LXE5",proofitInProgressTabTitle:"_2bY4K",proofitInProgressTabTitleContainerMultiple:"_24oEX",proofitInProgressTabTitleMain:"_3LF4o",fade:"_3Ae2t",proofitInProgressTabTitleSecondary:"_3iGar",proofitInProgressTabCompletionBar:"h2POd"}},93497:(e,t,i)=>{i.d(t,{n:()=>n});var o=i(59312),s=i(98036);function n(e){return function(t){return t.lift(new r(e))}}var r=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate))},e}(),a=function(e){function t(t,i){var o=e.call(this,t)||this;return o.predicate=i,o.skipping=!0,o.index=0,o}return o.ZT(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},t}(s.L)}}]);